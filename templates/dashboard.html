{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gradify | Dashboard</title>

  <style>
    :root{
      --purple-grad: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      --purple: #6d28d9;
      --border: #e2e8f0;
      --muted: #64748b;
      --card-border: #f1f5f9;
      --danger: #ef4444;
      --soft: #f8fafc;
      --ink: #0f172a;
      --shadow: 0 14px 35px rgba(2,6,23,0.08);
    }

    *{ box-sizing:border-box; }
    html, body{
      margin:0; padding:0; height:100%;
      font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
      background:#fff; color:var(--ink);
      overflow-x:hidden;
    }

    /* ===== FIXED TOP BAR (ALWAYS FIXED) ===== */
    .topbar{
      position: fixed;
      top:0; left:0; right:0;
      z-index: 1500;
      height: 62px;
      background:#fff;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 14px;
    }

    .top-left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .menu-btn{
      width:42px;
      height:42px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-weight:950;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }
    .menu-btn:hover{ border-color: var(--purple); }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      letter-spacing:-0.4px;
      min-width:0;
    }
    .brand .logo-icon{
      width:40px; height:40px;
      border-radius:14px;
      background: var(--purple-grad);
      display:flex; align-items:center; justify-content:center;
      color:#fff; font-weight:950; font-size:18px;
      box-shadow: 0 12px 25px rgba(109,40,217,0.20);
      user-select:none;
      flex-shrink:0;
    }
    .brand .brand-text{
      font-size:18px;
      font-weight:950;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .top-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-shrink:0;
    }

    /* BLACK SEARCH ICON */
    .icon-link{
      width:42px;
      height:42px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      transition: 0.2s ease;
      user-select:none;
    }
    .icon-link:hover{
      border-color: var(--purple);
      transform: translateY(-1px);
    }

    /* reserve space for fixed topbar */
    body{ padding-top: 62px; }

    .app{ display:flex; min-height: calc(100vh - 62px); width:100%; }

    /* ===== OVERLAY ===== */
    .overlay{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.38);
      z-index: 1400;
    }
    .overlay.show{ display:block; }

    /* ===== SIDEBAR (DESKTOP FIXED) ===== */
    .sidebar{
      width:320px;
      height: calc(100vh - 62px);
      background:#fff;
      position:fixed;
      top:62px; left:0;
      z-index: 1450;
      padding:18px 18px 18px;
      overflow-y:auto;
      overflow-x:hidden;
      border-right: 1px solid var(--border);
      transition: transform .25s ease;
    }

    /* hide ugly scrollbar line */
    .sidebar::-webkit-scrollbar{ width: 0; height:0; }
    .sidebar{ scrollbar-width:none; }

    /* ===== PROFILE MINI CARD ===== */
    .profile-card{
      display:flex;
      align-items:center;
      gap:12px;
      background:#fbfbff;
      border:1px solid #e9d5ff;
      border-radius:20px;
      padding:14px;
      box-shadow: 0 12px 28px rgba(109,40,217,0.08);
      position:relative;
      margin-bottom: 14px;
    }

    .avatar-wrap{
      width:56px; height:56px;
      border-radius:50%;
      overflow:hidden;
      border:2px solid var(--border);
      background:#e2e8f0;
      flex-shrink:0;
      position:relative;
      cursor:pointer;
      user-select:none;
    }
    .avatar-wrap img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .avatar-overlay{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,0.35);
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transition: 0.2s ease;
    }
    .avatar-wrap:hover .avatar-overlay{ opacity:1; }
    .avatar-overlay span{
      color:#fff;
      font-size:22px;
      font-weight:950;
    }

    .user-info{
      flex:1;
      min-width:0;
    }
    .user-info .username{
      display:block;
      font-weight:950;
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .user-info .avg-text{
      display:block;
      margin-top:2px;
      font-size:12px;
      font-weight:850;
      color: var(--muted);
    }

    .dots{
      width:40px; height:40px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-weight:950;
      user-select:none;
      flex-shrink:0;
    }
    .dots:hover{ border-color: var(--purple); }

    .dropdown{
      position:absolute;
      right:14px;
      top:74px;
      width:190px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      box-shadow: 0 18px 60px rgba(2,6,23,0.16);
      overflow:hidden;
      display:none;
      z-index: 2000;
    }
    .dropdown.show{ display:block; }
    .dropdown a, .dropdown button{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      padding: 12px 14px;
      font-weight:900;
      font-size:13px;
      border:none;
      background:#fff;
      cursor:pointer;
      text-decoration:none;
      color: var(--ink);
    }
    .dropdown a:hover, .dropdown button:hover{ background: var(--soft); }
    .dropdown .danger{ color: var(--danger); }

    /* ===== SECTIONS ===== */
    .menu-section{ margin-top: 10px; }
    .section-trigger{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 10px;
      font-weight:950;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      border-radius:12px;
    }
    .section-trigger:hover{ background: var(--soft); }
    .arrow{ font-weight:950; color: var(--ink); }

    .section-content{ display:none; }
    .section-content.open{ display:block; }

    .nav-item{
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px 12px;
      border-radius:14px;
      text-decoration:none;
      color: var(--ink);
      font-weight:950;
      font-size:14px;
      transition: 0.2s ease;
      border-left: 4px solid transparent;
    }
    .nav-item:hover{
      background: var(--soft);
      border-left: 4px solid var(--purple);
      color: var(--purple);
      padding-left: 16px;
    }

    .nav-icon{ width:18px; height:18px; fill:#111; flex-shrink:0; }
    .nav-item:hover .nav-icon{ fill: var(--purple); }

    .logout{ color: var(--danger); }
    .logout .nav-icon{ fill: var(--danger); }
    .logout:hover{
      background: rgba(239,68,68,0.10);
      border-left: 4px solid var(--danger);
      color: var(--danger);
    }
    .logout:hover .nav-icon{ fill: var(--danger); }

    /* Notification badge inside sidebar */
    .bell-badge{
      margin-left:auto;
      min-width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--danger);
      color:#fff;
      font-size:12px;
      font-weight:950;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 0 7px;
    }

    /* ===== MAIN BODY ===== */
    .main-body{
      flex:1;
      margin-left:320px;
      padding: 18px 18px 30px;
      min-height: calc(100vh - 62px);
      background:#fff;
    }

    .welcome{
      background:#fff;
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .welcome h1{
      margin:0;
      font-size:26px;
      font-weight:950;
      letter-spacing:-0.6px;
      line-height:1.15;
    }
    .uname{
      background: var(--purple-grad);
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      font-weight: 950;
    }
    .welcome p{
      margin:10px 0 0;
      color: var(--muted);
      font-weight:800;
      font-size:13px;
      line-height:1.45;
      border-top: 1px solid rgba(15,23,42,0.06);
      padding-top: 10px;
    }

    .stats-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
      margin-top: 14px;
    }

    .stat-card{
      border:1px solid var(--border);
      border-radius:22px;
      background:#fff;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .stat-label{
      font-weight:950;
      font-size:12px;
      color: var(--muted);
      letter-spacing: 0.8px;
      text-transform: uppercase;
    }
    .stat-value{
      margin-top: 10px;
      font-size: 42px;
      font-weight:950;
      color: var(--purple);
      line-height: 1;
      display:block;
    }
    .stat-sub{
      margin-top: 10px;
      color: var(--muted);
      font-weight:900;
      font-size: 12px;
    }

    .best-val{
      font-size:22px !important;
      color: var(--ink) !important;
      font-weight: 950;
    }

    .subject-section{
      margin-top: 14px;
      border:1px solid var(--border);
      border-radius:22px;
      background:#fff;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .subject-title{
      margin:0;
      font-weight:950;
      font-size:16px;
      letter-spacing:-0.4px;
    }
    .subject-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:10px;
      margin-top: 12px;
    }
    .subject-card{
      border:1px solid var(--card-border);
      border-radius:18px;
      background:#fbfbff;
      padding: 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-weight:950;
      transition: 0.2s ease;
    }
    .subject-card:hover{
      border-color: var(--purple);
      transform: translateY(-1px);
    }
    .pct{ color: var(--purple); }

    .empty{
      margin-top: 12px;
      padding: 14px;
      border-radius:18px;
      border:1px dashed #cbd5e1;
      background: var(--soft);
      color: var(--muted);
      font-weight:900;
    }

    /* ===== MOBILE ===== */
    @media (max-width: 920px){
      .sidebar{
        transform: translateX(-110%);
        width: 86%;
        max-width: 340px;
        border-right: none; /* remove that ‚Äúvertical line‚Äù look */
        box-shadow: 0 18px 60px rgba(0,0,0,0.25);
      }
      .sidebar.open{ transform: translateX(0); }
      .main-body{
        margin-left:0;
      }
    }

    @media (max-width: 420px){
      .welcome h1{ font-size: 22px; }
      .stat-value{ font-size: 38px; }
    }



/* Desktop: hide hamburger + overlay, keep sidebar open */
@media (min-width: 921px){
  #menuBtn{ display:none !important; }
  .overlay{ display:none !important; }
  .sidebar{ transform:none !important; }
}


  

  /* ‚úÖ Small mobile tweaks */
  @media (max-width: 420px){
    .stat-value{ font-size:52px; }
    .stat-value.best{ font-size:28px; }
  }

  
/* ‚úÖ BIG BLACK numbers */
.black-big{
  font-size:64px;
  font-weight:950;
  color:#6d28d9;
  line-height:1;
}

/* ‚úÖ Best subject still big, but the SUBJECT TEXT becomes gradient */
.best-subject{
  font-size:36px;
  text-transform:uppercase;
}

/* ‚úÖ Purple gradient only on the text (MATHEMATICS etc) */
.best-gradient{
  background: var(--purple-grad);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  font-weight:950;
}

/* ‚úÖ Mobile responsiveness */
@media (max-width: 920px){
  .black-big{ font-size:52px; }
  .best-subject{ font-size:34px; }
}

@media (max-width: 420px){
  .black-big{ font-size:48px; }
  .best-subject{ font-size:30px; }
}


.notif-badge{
  margin-left:auto;
  min-width: 26px;
  height: 22px;
  padding: 0 8px;
  border-radius: 999px;
  background: #ef4444;
  color: #fff;
  font-weight: 950;
  font-size: 12px;
  display:flex;
  align-items:center;
  justify-content:center;
}

</style>
  </style>
</head>

<body>

  <!-- TOPBAR (FIXED) -->
  <div class="topbar">
    <div class="top-left">
      <!-- ‚ò∞ MUST BE LEFT -->
      <button class="menu-btn" id="menuBtn" type="button" aria-label="Open sidebar">‚ò∞</button>

      <div class="brand">
        <div class="logo-icon">G</div>
        <div class="brand-text">Gradify</div>
      </div>
    </div>

    <div class="top-actions">
      <!-- üîç BLACK SEARCH ICON -->
      <a class="icon-link" href="{% url 'search' %}" aria-label="Search users" title="Search">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"
             stroke="#000" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="7"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </a>
    </div>
  </div>

  <!-- overlay -->
  <div class="overlay" id="overlay"></div>

  <div class="app">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">

      <!-- Profile mini card -->
      <div class="profile-card">

        <form id="dashAvatarForm" method="post" action="{% url 'edit_profile' %}" enctype="multipart/form-data" style="margin:0;">
          {% csrf_token %}

          <div class="avatar-wrap" id="avatarBtn" title="Change profile picture">
            <img id="dashAvatarImg"
                 src="{% if request.user.userprofile.profile_pic %}{{ request.user.userprofile.profile_pic.url }}{% else %}{% static 'default_avatar.png' %}{% endif %}"
                 alt="Avatar">
            <div class="avatar-overlay"><span>+</span></div>
          </div>

          <input type="file" name="profile_pic" id="dashFileInput" hidden accept="image/*" />
        </form>

        <div class="user-info">
          <span class="username">{{ request.user.username|default:"Student" }}</span>
          <span class="avg-text">Average: {{ avg_percent|default:0 }}%</span>
        </div>

        <div class="dots" id="dotsBtn" aria-label="Profile menu">‚ãÆ</div>

        <div class="dropdown" id="profileDropdown">
          <a href="{% url 'profile' request.user.username %}">View Profile</a>
          <a href="{% url 'edit_profile' %}">Edit Profile</a>

          <!-- If you already have a delete avatar route, keep it. If not, remove this form line. -->
          <form method="post" action="#" style="margin:0;">
            {% csrf_token %}
            <button type="submit" class="danger">Delete Avatar</button>
          </form>
        </div>
      </div>

      <!-- MAIN MENU (collapsible) -->
      <div class="menu-section">
        <div class="section-trigger" data-target="mainMenu">
          Main Menu <span class="arrow" id="arrowMain">‚ñæ</span>
        </div>

        <div id="mainMenu" class="section-content open">

          <a href="{% url 'profile' request.user.username %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2-8 4.5V21h16v-2.5c0-2.5-3.58-4.5-8-4.5Z"/></svg>
            Profile
          </a>

          <a href="{% url 'messages_inbox' %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h4v-3h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 11H8.83L6 17.83V6h14Z"/></svg>
            Messages
          </a>

          <a href="{% url 'wallet' %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M21 7H3a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2Zm0 10H3V9h18Zm-4-3a1 1 0 1 1-1-1 1 1 0 0 1 1 1Z"/></svg>
            Wallet
          </a>

        
</a>


          <a href="#" class="nav-item" id="addNewBtn">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Add New
          </a>

          <a href="{% url 'view_scores' %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2Zm-5 14H7v-2h7v2Zm3-4H7v-2h10v2Zm0-4H7V7h10v2z"/></svg>
            View Scores
          </a>

        </div>
      </div>

      <!-- PERFORMANCE (collapsible) -->
      <div class="menu-section" style="margin-top:12px;">
        <div class="section-trigger" data-target="perfMenu">
          Performance <span class="arrow" id="arrowPerf">‚ñæ</span>
        </div>

        <div id="perfMenu" class="section-content open">

          <a href="{% url 'graph' %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 3h2v18H3V3Zm4 10h2v8H7v-8Zm4-6h2v14h-2V7Zm4 4h2v10h-2V11Zm4-8h2v18h-2V3Z"/></svg>
            Graph
          </a>

          <a href="{% url 'settings' %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19.14 12.94a7.83 7.83 0 0 0 .05-.94 7.83 7.83 0 0 0-.05-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.3 7.3 0 0 0-1.63-.94l-.36-2.54A.5.5 0 0 0 13.9 1h-3.8a.5.5 0 0 0-.49.42l-.36 2.54a7.3 7.3 0 0 0-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L2.71 7.48a.5.5 0 0 0 .12.64l2.03 1.58a7.83 7.83 0 0 0-.05.94 7.83 7.83 0 0 0 .05.94L2.83 14.52a.5.5 0 0 0-.12.64l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.5.38 1.05.7 1.63.94l.36 2.54a.5.5 0 0 0 .49.42h3.8a.5.5 0 0 0 .49-.42l.36-2.54c.58-.24 1.13-.56 1.63-.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64Zm-7.14 2.56A3.5 3.5 0 1 1 15.5 12 3.5 3.5 0 0 1 12 15.5Z"/></svg>
            Settings
          </a>

          <a href="{% url 'help_support' %}" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm1 15h-2v-2h2v2Zm0-4h-2V7h2v6z"/></svg>
            Help &amp; Support
          </a>

          <a href="{% url 'logout' %}" class="nav-item logout">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M10 17l1.41-1.41L8.83 13H21v-2H8.83l2.58-2.59L10 7l-7 7 7 7ZM3 5h8V3H3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8v-2H3V5Z"/></svg>
            Logout
          </a>

        </div>
      </div>

    </aside>

    <!-- MAIN -->
    <main class="main-body">

      <section class="welcome">
        <h1>Welcome back, <span class="uname">{{ request.user.username|default:"Student" }}</span>.</h1>
        <p>
          {% if subjects %}
            Your subjects are set ‚Äî consistency is the cheat code. Let‚Äôs keep going.
          {% else %}
            You haven‚Äôt chosen your subjects yet. Tap <strong>Add New</strong> to set them up.
          {% endif %}
        </p>
      </section>

      <section class="stats-grid">
      <div class="stats-grid">

  <!-- ‚úÖ TOTAL SESSIONS -->
  <div class="stat-card">
 <span class="stat-label" style="color: #111; font-size: 18px;" >Total Sessions</span>
    <span class="stat-value black-big">{{ total_sessions|default:0 }}</span>
    <div class="stat-sub">{{ total_sessions|default:0 }} sessions</div>
  </div>

  <!-- ‚úÖ STUDY STREAK -->
  <div class="stat-card">
    <span class="stat-label" style="color: #111; font-size: 18px;">Study Streak</span>
    <span class="stat-value black-big">{{ streak_days|default:0 }}</span>
    <div class="stat-sub">{{ streak_days|default:0 }} days</div>
  </div>

  <!-- ‚úÖ BEST SUBJECT -->
  <div class="stat-card">
    <span class="stat-label" style="color: #111; font-size: 18px;">Best Subject</span>

    <!-- ‚úÖ Big black value + purple gradient subject name -->
    <span class="stat-value black-big best-subject">
      <span class="best-gradient">{{ best_subject|default:"‚Äî" }}</span>
    </span>

    <div class="stat-sub">Highest performance so far</div>
  </div>

</div>
      </section>

      <section class="subject-section">
        <h2 class="subject-title">Subject Performance</h2>

        {% if subjects %}
          <div class="subject-grid">
            {% for s in subjects %}
              <div class="subject-card">
                <span>{{ s.name }}</span>
                <span class="pct">{{ s.percent }}%</span>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty">No subjects yet. Tap <strong>Add New</strong> to choose your subjects.</div>
        {% endif %}
      </section>

    </main>
  </div>

  <script>
    // ===== Drawer open/close =====
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const menuBtn = document.getElementById("menuBtn");

    function openDrawer(){
      sidebar.classList.add("open");
      overlay.classList.add("show");
    }
    function closeDrawer(){
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    }

    menuBtn.addEventListener("click", () => {
      if (sidebar.classList.contains("open")) closeDrawer();
      else openDrawer();
    });

    overlay.addEventListener("click", closeDrawer);

    // close drawer when clicking link (mobile)
    document.querySelectorAll(".sidebar a.nav-item").forEach(a => {
      a.addEventListener("click", () => closeDrawer());
    });

    // ===== Collapsible sections (Main Menu + Performance can close) =====
    document.querySelectorAll(".section-trigger").forEach(t => {
      t.addEventListener("click", () => {
        const targetId = t.getAttribute("data-target");
        const panel = document.getElementById(targetId);
        panel.classList.toggle("open");

        if (targetId === "mainMenu") {
          document.getElementById("arrowMain").textContent = panel.classList.contains("open") ? "‚ñæ" : "‚ñ∏";
        }
        if (targetId === "perfMenu") {
          document.getElementById("arrowPerf").textContent = panel.classList.contains("open") ? "‚ñæ" : "‚ñ∏";
        }
      });
    });

    // ===== Profile dropdown =====
    const dotsBtn = document.getElementById("dotsBtn");
    const dropdown = document.getElementById("profileDropdown");

    dotsBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      dropdown.classList.toggle("show");
    });

    document.addEventListener("click", () => dropdown.classList.remove("show"));

    // ===== Dashboard avatar upload (DB-backed) =====
    const avatarBtn = document.getElementById("avatarBtn");
    const fileInput = document.getElementById("dashFileInput");
    const avatarImg = document.getElementById("dashAvatarImg");
    const form = document.getElementById("dashAvatarForm");

    // IMPORTANT: this makes tapping the + open gallery on mobile
    avatarBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      fileInput.click();
    });

    fileInput.addEventListener("change", () => {
      const file = fileInput.files && fileInput.files[0];
      if (!file) return;

      // instant preview before submit
      const reader = new FileReader();
      reader.onload = (ev) => {
        avatarImg.src = ev.target.result;
        // submit right after preview so it saves to DB
        form.submit();
      };
      reader.readAsDataURL(file);
    });

    // ===== Add New behavior (first time -> setup subjects) =====
    const hasSubjects = {{ subjects|length|default:0 }};
    document.getElementById("addNewBtn").addEventListener("click", (e) => {
      e.preventDefault();
      if (!hasSubjects) window.location.href = "{% url 'setup_subjects' %}";
      else window.location.href = "{% url 'add_score' %}";
    });
  </script>

</body>
</html>
